<head>
<script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
<script src="./ccxt.mini.js"></script>
<script src="../dist/ta-math.umd.js"></script>
</head>
<body>
<!-- Plotly chart will be drawn inside this div -->
<div id="plotly-div" style="width: 600px; height: 400px;"></div>
<script>

var promise = new ccxt.binance({'proxy': 'https://cors-anywhere.herokuapp.com/'}).fetchOHLCV ('BTC/USDT', '1d', Date.now() - 1000*60*60*24*30*5);
promise.then( 
  function(ohlcv) {
    var ta = new TA(ohlcv, TA.exchangeFormat());

    var time=[], close=[], high=[], low=[], open=[];
    for(var i = 0, len = ohlcv.length; i < len; i++) {
      time.push(ohlcv[i][0]);
      open.push(ohlcv[i][1]);
      high.push(ohlcv[i][2]);
      low.push(ohlcv[i][3]);
      close.push(ohlcv[i][4]);
    }
    var candlestick = {
      name: 'BTC/USDT',
      x: time, 
      close: close, 
      high: high, 
      low: low, 
      open: open, 
      type: 'candlestick', 
      decreasing: {line: {color: '#FF3860'}}, 
      increasing: {line: {color: '#23D160'}}, 
      line: {color: 'rgba(123,123,12,3)'}, 
      xaxis: 'x', 
      yaxis: 'y'
    };
    var bb = ta.bb();

    var bbUpper = {
      showlegend: false,
      x: time,
      y: bb.upper,
      type: 'line',
      line: {color: 'rgba(255,255,255,0)'}
    }

    var bbMiddle = {
      name: 'SMA(15)',
      x: time,
      y: bb.middle,
      type: 'line',
      line: {color: '#FFE22F'}
    }

    var bbLower = {
      name: 'BBAND(15,2)',
      x: time,
      y: bb.lower,
      fill: 'tonexty',
      type: 'line',
      mode: 'none',
      line: {color: 'rgba(255,226,150,0.1)'}
    }

    var data = [bbUpper, bbLower, bbMiddle, candlestick];

    var layout = {
      showlegend: true,
	    legend: {"orientation": "h"},
      dragmode: 'zoom',
      margin: {
        r: 5, 
        t: 5, 
        b: 50, 
        l: 5
      }, 
      xaxis: {
        autorange: true,
        type: 'date'
      }, 
      yaxis: {
        autorange: true,
        type: 'linear'
      }
    };
    var defaultPlotlyConfiguration = { modeBarButtonsToRemove: ['sendDataToCloud', 'autoScale2d', 'hoverClosestCartesian', 'hoverCompareCartesian', 'lasso2d', 'select2d'], displaylogo: false, showTips: true };

    Plotly.plot('plotly-div', data, layout, defaultPlotlyConfiguration);
  }
);

</script>
</body>
</html>